<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Sentimientos - El Caf√© de Tere</title>
    <style>
        :root {
            --primary-color: #a0512deb; /* Marr√≥n caf√© */
            --primary-color-dark: #A0522D; /* Marr√≥n caf√© */
            --secondary-color: #D2B48C; /* Beige claro */
            --background-color: #F8F4E3; /* Crema suave */
            --text-color: #333333;
            --positive-color: #38A169; /* Verde */
            --negative-color: #E53E3E; /* Rojo */
            --neutral-color: #3182CE; /* Azul */
            --shadow-light: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow-light);
        }
        .header h1 {
            margin: 0;
            font-size: 2em;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow-light);
        }
        /* Layout Grid */
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .grid-2-1 {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        /* Elementos espec√≠ficos */
        .summary-box {
            background-color: var(--secondary-color);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .summary-box h3 {
            color: var(--primary-color);
            margin-top: 0;
        }
        .metric {
            text-align: center;
            padding: 10px;
            border-left: 3px solid var(--primary-color);
        }
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0;
        }
        .metric-label {
            font-size: 0.9em;
            color: #666;
        }
        /* Estilos para el Gr√°fico de Sentimientos */
        #sentiment-chart-container {
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .pie-slice {
            border-radius: 50%;
            height: 100%;
            width: 100%;
            display: block;
        }
        /* Estilos para Acorde√≥n de T√≥picos */
        .accordion-item {
            border: 1px solid #ddd;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .accordion-title {
            background-color: var(--secondary-color);
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: var(--primary-color);
            border-radius: 4px 4px 0 0;
        }
        .accordion-content {
            padding: 15px;
            border-top: 1px solid #eee;
            display: none;
            overflow: hidden;
            background-color: #fffaf0;
        }
        .sentiment-block {
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .positive { background-color: #e6fffa; border-left: 5px solid var(--positive-color); }
        .negative { background-color: #fff5f5; border-left: 5px solid var(--negative-color); }
        .challenge { background-color: #ebf8ff; border-left: 5px solid var(--neutral-color); }
        .sentiment-block strong {
            display: block;
            margin-bottom: 5px;
        }
        .colocation-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
        }
        .colocation-list li {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        /* Estilos para Tablas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Estilo para las etiquetas interactivas */
.interactive-tag {
    display: inline-block;
    padding: 8px 12px;
    margin: 5px;
    border-radius: 20px;
    background-color: var(--primary-color-dark); /* Color oscuro para contraste */
    color: white;
    cursor: pointer; /* Indica que es clickeable */
    transition: background-color 0.2s, transform 0.1s;
    font-size: 0.9em;
    font-weight: 500;
}

.interactive-tag:hover {
    background-color: var(--primary-color);
    transform: translateY(-2px);
}

.interactive-tag.active {
    background-color: var(--secondary-color); /* Color de resaltado al ser seleccionada */
}

/* Estilo para la caja de detalle */
#entity-detail-box {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-left: 5px solid var(--primary-color);
    background-color: var(--background-color-light);
    min-height: 50px;
    transition: all 0.3s ease-in-out;
}

#entity-detail-box p {
    margin: 0;
    line-height: 1.4;
}

        /* --- INICIO: Media Queries para Responsive Design --- */
    @media (max-width: 768px) {
        /* 1. Contenedor principal: Vuelve a una sola columna */
        .container {
            padding: 10px;
        }

        /* 2. Reseteo de Grids: Vuelven a ser de una sola columna */
        .grid-3, .grid-2-1 {
            grid-template-columns: 1fr;
            gap: 15px; /* Reduce el espacio */
        }

        /* 3. Ajuste del Card del Sentimiento y Pie Chart */
        #sentiment-chart-container {
            height: 200px; /* Hace el gr√°fico m√°s peque√±o */
        }
        
        /* 4. Ajuste de M√©trica (para que no se amontonen) */
        .grid-3 > .metric {
             /* Convierte las m√©tricas en una fila √∫nica horizontal */
            display: flex;
            flex-direction: column; 
            align-items: center;
            border-left: none;
            border-bottom: 2px solid var(--primary-color);
            padding: 10px 0;
        }
        .metric-value {
            font-size: 2em; /* Reduce el tama√±o del texto grande */
        }

        /* 5. Ajuste de la lista de Colocaciones */
        .colocation-list {
            justify-content: center; /* Centra las etiquetas */
        }
        
        /* 6. Heatmap (Asegura que la tabla se pueda desplazar) */
        .card > div[style*="overflow-x"] {
            overflow-x: scroll; /* Fuerza el desplazamiento horizontal si la tabla es muy ancha */
            -webkit-overflow-scrolling: touch;
        }

        /* 7. Ajuste de Tablas (Headers m√°s peque√±os) */
        .data-table th, .data-table td {
            font-size: 0.8em;
            padding: 3px;
        }
    }
    /* --- FIN: Media Queries para Responsive Design --- */
    </style>
</head>
<body>

    <div class="header">
        <h1>‚òï Dashboard: An√°lisis de Sentimientos - El Caf√© de Tere en X</h1>
        <p>Posici√≥n de Marca, Estrategias y Desaf√≠os</p>
    </div>

    <div class="container">

        <div class="grid-2-1">
            <div class="card">
                <h2>üìä Resumen Ejecutivo y Conclusi√≥n de Negocio</h2>
                <div class="summary-box">
                    <h3>Resumen de Tem√°ticas (Topics)</h3>
                    <p id="summary-text"></p>
                </div>
                <div class="summary-box">
                    <h3>Conclusi√≥n y Giro Estrat√©gico Recomendado</h3>
                    <p id="conclusion-text"></p>
                </div>
            </div>
            <div class="card">
                <h2>üìà Sentimiento Global</h2>
                <div id="sentiment-chart-container">
                    <div class="pie-slice" id="sentiment-pie"></div>
                </div>
                <div class="grid-3" style="margin-top: 20px;">
                    <div class="metric">
                        <span class="metric-value" style="color: var(--negative-color);" id="neg-val"></span>
                        <span class="metric-label">Negativos (47%)</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value" style="color: var(--positive-color);" id="pos-val"></span>
                        <span class="metric-label">Positivos (38%)</span>
                    </div>
                    <div class="metric">
                        <span class="metric-value" style="color: var(--neutral-color);" id="neu-val"></span>
                        <span class="metric-label">Neutros (15%)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid-2-1">
            <div class="card">
                <h2>üí¨ T√≥picos y Tem√°ticas Principales (Voz del Cliente)</h2>
                <div id="topics-accordion">
                    </div>
            </div>
            <div class="card">
                <h2>‚≠ê Top 10 Tweets con M√°s Engagement</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Tweet</th>
                            <th>Likes</th>
                            <th>RTs</th>
                        </tr>
                    </thead>
                    <tbody id="top-engagement-table">
                        </tbody>
                </table>
            </div>
        </div>



        <div class="grid-2-1">
            <div class="card">
                <h2>üî• Patrones de Interacci√≥n: Likes por Hora y D√≠a</h2>
                <p>Identifica los "puntos calientes" para optimizar el horario de publicaci√≥n.</p>
                <div style="overflow-x: auto;">
                    <table class="data-table" id="heatmap-table" style="min-width: 100px;">
                        </table>
                </div>
            </div>
            <div class="card">
                <h2>üìâ Estad√≠sticas Clave</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>M√©trica</th>
                            <th>Media (Avg)</th>
                            <th>Max.</th>
                        </tr>
                    </thead>
                    <tbody id="stats-table">
                        </tbody>
                </table>
                
                <div style="margin-top: 20px;">
                <h2>üîó Colocaciones M√°s Relevantes (Top 10)</h2>
                <ul class="colocation-list" id="colocations-list">
                     </ul>
                </div> 

                <h2>üîó Entidades M√°s Relevantes</h2>
            <div id="entity-list-container" class="colocation-list">
                </div>
            
            <div id="entity-detail-box">
                <p>Haga clic en una etiqueta para ver su detalle.</p>
            </div>
            </div>
        </div>

        <div class="card">
            
        </div>

    </div>

    <script>
        // Datos JSON (Embedidos para simplicidad)
        const rawData = {
            "describe_matrix": {"count": {"favorite_count": 1198.0, "id": 1199.0, "retweet_count": 1198.0, "user.followers_count": 1198.0, "user.friends_count": 1198.0}, "mean": {"favorite_count": 12.20, "id": 1.19e+18, "retweet_count": 33.93, "user.followers_count": 5046.37, "user.friends_count": 1021.63}, "std": {"favorite_count": 104.53, "id": 3.44e+16, "retweet_count": 815.06, "user.followers_count": 72793.24, "user.friends_count": 6446.56}, "min": {"favorite_count": 0.0, "id": 167.0, "retweet_count": 0.0, "user.followers_count": 1.0, "user.friends_count": 0.0}, "25%": {"favorite_count": 0.0, "id": 1.19e+18, "retweet_count": 0.0, "user.followers_count": 186.5, "user.friends_count": 262.0}, "50%": {"favorite_count": 0.0, "id": 1.19e+18, "retweet_count": 0.0, "user.followers_count": 483.0, "user.friends_count": 532.5}, "75%": {"favorite_count": 2.0, "id": 1.19e+18, "retweet_count": 1.0, "user.followers_count": 1377.25, "user.friends_count": 992.75}, "max": {"favorite_count": 2733.0, "id": 1.19e+18, "retweet_count": 28090.0, "user.followers_count": 1997889.0, "user.friends_count": 221536.0}},
            "corr_matrix": {"user.followers_count": {"user.followers_count": 1.0, "user.friends_count": 0.577, "id": -0.145, "favorite_count": 0.374, "retweet_count": 0.128}, "user.friends_count": {"user.followers_count": 0.577, "user.friends_count": 1.0, "id": -0.093, "favorite_count": 0.164, "retweet_count": 0.054}, "id": {"user.followers_count": -0.145, "user.friends_count": -0.093, "id": 1.0, "favorite_count": -0.128, "retweet_count": 0.076}, "favorite_count": {"user.followers_count": 0.374, "user.friends_count": 0.164, "id": -0.128, "favorite_count": 1.0, "retweet_count": 0.121}, "retweet_count": {"user.followers_count": 0.128, "user.friends_count": 0.054, "id": 0.076, "favorite_count": 0.121, "retweet_count": 1.0}},
            "engagement_matrix": {"text": {"3276": "@dearc26 @eluniversocom Q insoportable estas personas resentidas. Viven amargados! Hay gustos y gustos. El bol√≥n de Tere es rico!", "3738": "Se acab√≥ el chisme con el #closetdedav y ahora leo twists del #cafedetere... qu√© tiro guayaquile√±os todo bien en casa?", "2198": "@KaritoSoBsc Oe oe oe bien recuerdo que una vez twitteaste qu√© m√°s barato Te sal√≠a comprar un departamento en salin‚Ä¶ https://t.co/FL0MGZv9Hx", "1951": "La se√±ora del caf√© d Tere es la prueba de q trabajando duro se puede llegar a rico. Ella ha demostrado q no es nece‚Ä¶ https://t.co/JMNbFyKLS", "3457": "@tere_marinovic En esta crisis, no hay buenos ni malos, se enfrentan entre chilenos, padres y familias. Y todo este‚Ä¶ https://t.co/CQsnaeEs8Z", "2148": "Si el cafe de tere te parece que es caro, turro y puro mkt anda busca otro bolon chtm\nEl ecuatoriano pr√≥spero tiene‚Ä¶ https://t.co/APCz649NbZ", "932": "Soy cliente regular del Caf√© de Tere. Ahora bien, que siga sin aceptar tarjetas de cr√©dito es indefendible. Do√±a Te‚Ä¶ https://t.co/jHdbRXcdfa", "2751": "El bol√≥n de Tere no es nada fuera de lo com√∫n, malo tampoco es, en su tiempo fue lo mejorcito y ahora solo es tradi‚Ä¶ https://t.co/NQIPQL9tNB", "347": "En fin,caso parcido en el caf√© de Tere un cliente NO PAGA s√≥lo por el bolon. Tambi√©n paga por la buena atenci√≥n, el‚Ä¶ https://t.co/fGLTTg0HBW", "810": "@gabita Gabita por cuestiones de trabajo hace a√±os estuve en las cocinas de dos locales de Tere. PARECEN QUIROFANOS‚Ä¶ https://t.co/MkVUhzydR2"}, "favorite_count": {"3276": 79.0, "3738": 10.0, "2198": 46.0, "1951": 332.0, "3457": 7.0, "2148": 187.0, "932": 130.0, "2751": 152.0, "347": 16.0, "810": 7.0}, "retweet_count": {"3276": 1.0, "3738": 3.0, "2198": 3.0, "1951": 81.0, "3457": 3.0, "2148": 63.0, "932": 35.0, "2751": 49.0, "347": 1.0, "810": 4.0}, "total_engagement": {"3276": 86.81, "3738": 66.67, "2198": 63.89, "1951": 61.14, "3457": 19.44, "2148": 15.58, "932": 13.31, "2751": 13.21, "347": 12.9, "810": 12.28}},
            "heatmap": {"Monday": {"0.0": -1.0, "1.0": 0.0, "2.0": -1.0, "3.0": 0.0, "4.0": -1.0, "5.0": -1.0, "6.0": -1.0, "7.0": 0.0, "8.0": -1.0, "9.0": 0.0, "10.0": -1.0, "11.0": 0.0, "12.0": -1.0, "13.0": -1.0, "14.0": 1.0, "15.0": 1.0, "16.0": 3.0, "17.0": 177.0, "18.0": -1.0, "19.0": -1.0, "20.0": -1.0, "21.0": -1.0, "22.0": 2734.0, "23.0": 82.0}, "Tuesday": {"0.0": 1.0, "1.0": 32.0, "2.0": 20.0, "3.0": 0.0, "4.0": 3.0, "5.0": -1.0, "6.0": -1.0, "7.0": 1.0, "8.0": -1.0, "9.0": 0.0, "10.0": -1.0, "11.0": 1.0, "12.0": 3.0, "13.0": 73.0, "14.0": 195.0, "15.0": 18.0, "16.0": 174.0, "17.0": 102.0, "18.0": 1012.0, "19.0": 651.0, "20.0": 210.0, "21.0": 412.0, "22.0": 1555.0, "23.0": 1331.0}, "Wednesday": {"0.0": 209.0, "1.0": 906.0, "2.0": 1789.0, "3.0": 895.0, "4.0": 265.0, "5.0": 37.0, "6.0": 27.0, "7.0": 31.0, "8.0": 37.0, "9.0": 4.0, "10.0": 12.0, "11.0": 64.0, "12.0": 46.0, "13.0": 115.0, "14.0": 98.0, "15.0": 76.0, "16.0": 35.0, "17.0": 160.0, "18.0": 24.0, "19.0": 34.0, "20.0": 22.0, "21.0": 282.0, "22.0": 65.0, "23.0": 83.0}, "Thursday": {"0.0": 37.0, "1.0": 104.0, "2.0": 40.0, "3.0": 10.0, "4.0": 15.0, "5.0": 8.0, "6.0": 0.0, "7.0": 0.0, "8.0": -1.0, "9.0": 0.0, "10.0": 0.0, "11.0": 1.0, "12.0": 17.0, "13.0": 5.0, "14.0": 1.0, "15.0": 3.0, "16.0": 57.0, "17.0": 29.0, "18.0": 0.0, "19.0": 1.0, "20.0": 16.0, "21.0": 1.0, "22.0": 1.0, "23.0": 100.0}, "Friday": {"0.0": 5.0, "1.0": 0.0, "2.0": -1.0, "3.0": -1.0, "4.0": -1.0, "5.0": -1.0, "6.0": -1.0, "7.0": -1.0, "8.0": -1.0, "9.0": -1.0, "10.0": -1.0, "11.0": -1.0, "12.0": -1.0, "13.0": -1.0, "14.0": 8.0, "15.0": -1.0, "16.0": -1.0, "17.0": -1.0, "18.0": -1.0, "19.0": -1.0, "20.0": -1.0, "21.0": -1.0, "22.0": -1.0, "23.0": -1.0}, "Saturday": {"0.0": 5.0, "1.0": -1.0, "2.0": -1.0, "3.0": -1.0, "4.0": -1.0, "5.0": -1.0, "6.0": -1.0, "7.0": -1.0, "8.0": -1.0, "9.0": -1.0, "10.0": 11.0, "11.0": -1.0, "12.0": -1.0, "13.0": 0.0, "14.0": 0.0, "15.0": 5.0, "16.0": 2.0, "17.0": 8.0, "18.0": -1.0, "19.0": -1.0, "20.0": -1.0, "21.0": 0.0, "22.0": -1.0, "23.0": -1.0}, "Sunday": {"0.0": -1.0, "1.0": 0.0, "2.0": -1.0, "3.0": -1.0, "4.0": -1.0, "5.0": -1.0, "6.0": -1.0, "7.0": -1.0, "8.0": -1.0, "9.0": -1.0, "10.0": -1.0, "11.0": -1.0, "12.0": -1.0, "13.0": 7.0, "14.0": -1.0, "15.0": 0.0, "16.0": 0.0, "17.0": -1.0, "18.0": 1.0, "19.0": -1.0, "20.0": -1.0, "21.0": -1.0, "22.0": 0.0, "23.0": -1.0}},
            "topics": {"topics": [{"title": "Precio y percepci√≥n de ‚Äúsobrevalorado‚Äù", "detail": "Alto volumen de quejas por precios de bolones (3,50‚Äì5 USD) y extras (p.ej. huevo frito), comparados con huecas m√°s baratas.", "positive": "Clientes justifican precio por higiene, locales c√≥modos, porciones que ‚Äòllenan‚Äô y consistencia de oferta.", "negative": "‚ÄúCaro/robo/sobrevalorado‚Äù; comparaci√≥n con mercados y huecas de 1‚Äì2 USD; relaci√≥n precio-sabor cuestionada.", "challenge": "Clarificar propuesta de valor y costos; lanzar combos/porciones S-M-L; precios ‚Äòdesde‚Äô; d√≠as/horas con promos; comunicar est√°ndares e ingredientes."}, {"title": "Sabor y consistencia del producto (bol√≥n y tigrillo)", "detail": "Opiniones polarizadas: para algunos es referente; para otros, ‚Äúnormalito‚Äù, ‚Äúseco‚Äù, ‚Äúfr√≠o‚Äù o con exceso de l√°cteos.", "positive": "Bol√≥n mixto (maduro/chicharr√≥n) y chicharr√≥n muy bien valorados; varios destacan el tigrillo y el aj√≠.", "negative": "Cr√≠ticas a tigrillo ‚Äúsopudo/ins√≠pido‚Äù; bolones servidos fr√≠os; sabor ‚Äúindustrializado‚Äù; uso de margarina; p√©rdida de saz√≥n original.", "challenge": "Programa de control sensorial por local; auditor√≠as de temperatura/grasas; receta √∫nica vs ediciones ‚Äòartesanales‚Äô; pilotos de mejora de tigrillo/aji."}, {"title": "Relaci√≥n porci√≥n‚Äìvalor percibido", "detail": "Debate sobre tama√±o vs precio y ‚Äòllenura‚Äô.", "positive": "Clientes dicen que ‚Äúmantiene lleno‚Äù y valoran la satisfacci√≥n del plato.", "negative": "Percepci√≥n de porciones peque√±as por el precio.", "challenge": "Ofrecer tama√±os y ‚Äòupgrades‚Äô claros; fotos reales; bundle de prote√≠na/jugo a precio cerrado."}, {"title": "M√©todos de pago y fricciones de compra", "detail": "Reclamo recurrente: no aceptar tarjetas/medios electr√≥nicos.", "positive": "Algunos ven el proceso r√°pido y ordenado cuando funciona.", "negative": "‚ÄúCash-only‚Äù, molestia por falta de POS/QR/contactless.", "challenge": "Implementar POS, QR y wallets; comunicar d√≥nde ya opera; meta: >90% transacciones electr√≥nicas en 90 d√≠as."}, {"title": "Delivery y m√≠nimos de pedido", "detail": "Quejas por m√≠nimo elevado (p.ej. 17 USD) y costos.", "positive": "Alta demanda a domicilio en fines de semana/familias.", "negative": "Percepci√≥n de delivery ‚Äúcaro‚Äù para pedidos peque√±os.", "challenge": "Escalonar m√≠nimos por zona/horario; men√∫s de env√≠o econ√≥mico; alianzas con apps; cocinas de reparto por sector."}, {"title": "Limpieza, ambiente y servicio", "detail": "La higiene es un diferenciador percibido; hay cr√≠ticas puntuales de atenci√≥n/tiempos.", "positive": "Cocinas ‚Äúcomo quir√≥fanos‚Äù, locales limpios y ambiente acogedor.", "negative": "Casos de platos fr√≠os, tiempos y protocolo poco claro (retiro de bandejas).", "challenge": "Estandarizar tiempos de pase; checklist de sala; se√±al√©tica de autoservicio; KPI de temperatura/tiempo y encuestas QR."}, {"title": "Marca, marketing y reputaci√≥n (polarizaci√≥n)", "detail": "Caso de √©xito admirado que genera discusi√≥n ‚Äòlovers vs haters‚Äô.", "positive": "Orgullo por la historia de emprendimiento; top-of-mind nacional; ‚Äúparada obligada‚Äù.", "negative": "Percepci√≥n de elitismo; ataques en redes; discusi√≥n clasista (‚Äòani√±ado vs chiro‚Äô).", "challenge": "Plan de reputaci√≥n y escucha activa; narrativa inclusiva; vocer√≠a con datos (empleo, proveedores); campa√±as con causa y comunidad."}, {"title": "Autenticidad vs expansi√≥n (‚Äòindustrializaci√≥n‚Äô)", "detail": "Se percibe p√©rdida de ‚Äòsaz√≥n de hueca‚Äô al crecer.", "positive": "Escala que integr√≥ distintos p√∫blicos; consistencia b√°sica.", "negative": "‚ÄúPerdi√≥ la esencia‚Äù; ‚Äúindustrializado‚Äù.", "challenge": "L√≠neas ‚ÄòHerencia‚Äô/‚Äôrecetas de origen‚Äô por tiempo limitado; entrenar ‚Äòmaestros de saz√≥n‚Äô; rotaci√≥n de lotes de chicharr√≥n/queso controlada."}, {"title": "Comparaci√≥n con competidores y alternativas", "detail": "Se mencionan Amorfino, Rey Bol√≥n, Verde y Caf√©, Bol√≥nCity, mercados y huecas barriales.", "positive": "El liderazgo trae benchmarking √∫til; algunos colocan a Tere en su Top 3.", "negative": "‚ÄúHay 2 o 3 mejores y m√°s baratos‚Äù.", "challenge": "Mapear categor√≠a y gaps de sabor/precio; diferenciar con innovaci√≥n (sabores, toppings, prote√≠nas, ajiolog√≠as) sin perder core."}, {"title": "Portafolio y extras (aj√≠, jugos, caf√©, huevos)", "detail": "El aj√≠ y jugos generan amor/odio; costos de extras levantan polvo.", "positive": "Jugo de naranja muy valorado; aj√≠ amado por parte de la clientela.", "negative": "‚ÄúAj√≠ no es aj√≠‚Äù; caf√© regular; $1 por huevo frito incomoda; precios altos en bebidas en algunos casos.", "challenge": "Reformulaci√≥n de aj√≠ con catas; ‚Äòcaf√© mejorado‚Äô; precios psicol√≥gicos de extras; bundles desayuno con bebida."}, {"title": "Expansi√≥n geogr√°fica y demanda insatisfecha", "detail": "Alta intenci√≥n en Sierra/Quito/Cuenca y hasta exterior; parada de quite√±os al llegar a GYE.", "positive": "Marca aspiracional con demanda fuera de GYE.", "negative": "P√©rdida de ventas por no estar en Sierra; log√≠stica/pagos limitan alcance.", "challenge": "Pilotos pop-up/dark kitchen en Quito; franquicias selectivas; ecommerce con env√≠os de kits; estudio de plaza y unit economics."}, {"title": "Comunicaci√≥n en redes y manejo de crisis", "detail": "Oleadas virales dan ‚Äòpublicidad gratis‚Äô pero tambi√©n desgaste.", "positive": "Alta conversaci√≥n y recordaci√≥n; oportunidad de insights en tiempo real.", "negative": "Escalada de hate, comparaciones y desinformaci√≥n; respuestas defensivas entre usuarios.", "challenge": "Playbook de crisis, social listening, respuesta emp√°tica; contenidos ‚Äòbehind the scenes‚Äô de calidad, costos y proveedores; activaci√≥n con creadores gastron√≥micos."}], "summary": "La conversaci√≥n gira en torno a precio percibido como alto, sabor/consistencia del bol√≥n y tigrillo, fricciones por no aceptar tarjetas, delivery con m√≠nimos elevados, y una fuerte polarizaci√≥n entre admiraci√≥n al emprendimiento y cr√≠ticas por ‚Äòsobrevalorado‚Äô y p√©rdida de ‚Äòsaz√≥n‚Äô con la expansi√≥n. A la par, se valora la higiene, el chicharr√≥n, el bol√≥n mixto y el jugo; se piden mejoras en aj√≠, caf√© y extras. Hay demanda de expansi√≥n a la Sierra y necesidad de un plan robusto de reputaci√≥n y pagos electr√≥nicos.", "conclusion": "Prioridades recomendadas: 1) habilitar pagos electr√≥nicos en todos los locales; 2) elevar consistencia sensorial (temperatura, grasa, sal, humedad) con auditor√≠as y ‚Äòmaestros de saz√≥n‚Äô; 3) alinear precio-percepci√≥n con combos, tama√±os y comunicaci√≥n del valor; 4) redise√±ar delivery con m√≠nimos escalonados y cocinas de reparto; 5) refresh de aj√≠ y caf√©; 6) playbook de reputaci√≥n y contenidos educativos; 7) pilotos de expansi√≥n en Quito v√≠a pop-ups/dark kitchen; 8) medici√≥n continua (NPS, tiempos de pase) y benchmarking competitivo. Esto reducir√° el ruido negativo, aumentar√° conversi√≥n y proteger√° el equity de marca.", "feelings": {"positive": {"value": 38, "label": "Aprecio por la historia de emprendimiento, limpieza, chicharr√≥n y bol√≥n mixto; ‚Äòparada obligada‚Äô y orgullo local."}, "negative": {"value": 47, "label": "Precio ‚Äòcaro/sobrevalorado‚Äô, falta de tarjetas, delivery m√≠nimo alto, sabor inconsistente (seco/fr√≠o/sopudo), ‚Äòp√©rdida de saz√≥n‚Äô con expansi√≥n."}, "neutral": {"value": 15, "label": "Comentarios informativos/comparativos y llamados a ‚Äòcomer donde guste cada quien‚Äô sin tomar partido."}}},
            "colocations": {"colocations": [{"colocation": "Caf√© de Tere", "detail": "Marca hiper-presente y polarizante; reto reputacional y de gesti√≥n de crisis por alta visibilidad y expectativas."}, {"colocation": "Bol√≥n de Tere", "detail": "Producto ic√≥nico; cr√≠ticas por ser ‚Äònormalito‚Äô y caro en relaci√≥n porci√≥n/precio. Desaf√≠o: sostener sabor diferencial y justificar precio."}, {"colocation": "Tigrillo de Tere", "detail": "Opiniones divididas (‚Äòsopudo‚Äô, ‚Äòins√≠pido‚Äô vs fans). Reto: estandarizar textura y saz√≥n entre locales y turnos."}, {"colocation": "No aceptan tarjeta", "detail": "Fricci√≥n recurrente en el pago. Prioridad: habilitar tarjetas y medios digitales para reducir abandono."}, {"colocation": "Precio del bol√≥n", "detail": "Alta sensibilidad a $3,50‚Äì$5 y extras. Necesario gestionar valor percibido, combos y transparencia de precios."}, {"colocation": "Sobrevalorado y caro", "detail": "Narrativa frecuente en redes. Urge reforzar propuesta de valor (calidad, higiene, experiencia) para contrarrestarla."}]},
            "entities": {"entities": [
    {
        "entity": "Caf√© de Tere (@CafedeTere)",
        "detail": "Restaurante guayaquile√±o eje de la conversaci√≥n; elogios y cr√≠ticas por precio, calidad, servicio, limpieza, domicilios y no aceptar tarjetas."
    },
    {
        "entity": "Teresa Castro Mendoza (Do√±a Tere)",
        "detail": "Fundadora/propietaria; caso de √©xito emprendedor citado en notas y hilos."
    },
    {
        "entity": "Bol√≥n (Bol√≥n de Tere)",
        "detail": "Producto insignia; debate sobre sabor, precio y porciones; comparado con huecas y competidores."
    },
    {
        "entity": "Tigrillo",
        "detail": "Segundo producto clave; comentarios divididos (p.ej. 'sopudo/ins√≠pido' vs 'delicioso')."
    },
    {
        "entity": "El Universo",
        "detail": "Medio cuyo reportaje deton√≥ el pico de menciones y debate p√∫blico."
    },
    {
        "entity": "Twitter (X)",
        "detail": "Plataforma del debate con participaci√≥n de clientes, influencers y haters."
    },
    {
        "entity": "Tarjetas de cr√©dito / POS",
        "detail": "Tema sensible: se critica que no acepten tarjetas; se sugiere modernizar pagos (p.ej. Datafast)."
    },
    {
        "entity": "Domicilios y pedido m√≠nimo",
        "detail": "Cuestionamientos a m√≠nimos (p.ej. $17) y costos de delivery."
    },
    {
        "entity": "Ambiente, limpieza y servicio",
        "detail": "Atributos usados para justificar precios y preferencia; se√±alados como fortalezas."
    },
    {
        "entity": "SRI e IESS",
        "detail": "Mencionados para comparar costos formales de un negocio vs huecas informales."
    },
    {
        "entity": "CONAIE",
        "detail": "Referida ret√≥ricamente en hilos para descalificar a 'odiadores de empresarios'."
    },
    {
        "entity": "Amorfino Caf√©",
        "detail": "Competidor/alternativa recomendada; bolones y aj√≠ bien valorados."
    },
    {
        "entity": "Rey Bol√≥n",
        "detail": "Alternativa en el mismo rubro; comparado en precio/calidad."
    },
    {
        "entity": "Juan Tonga",
        "detail": "Alternativa de bolones; aparece en men√∫s comparativos."
    },
    {
        "entity": "Caf√© Real",
        "detail": "Alternativa citada (tigrillo preferido por algunos)."
    }
]}
        };

        const data = {
            describe_matrix: rawData.describe_matrix,
            corr_matrix: rawData.corr_matrix,
            engagement_matrix: rawData.engagement_matrix,
            heatmap: rawData.heatmap,
            topics: rawData.topics,
            colocations: rawData.colocations,
            entities: rawData.entities
        };
        
        // Colores para el Heatmap
        const minColor = '#fffaf0'; // Beige claro (bajo engagement)
        const maxColor = '#A0522D'; // Marr√≥n Caf√© (alto engagement)
        
        // --- Funciones de Renderizado ---

        // 1. Renderizar Resumen y Conclusi√≥n
        document.getElementById('summary-text').innerText = data.topics.summary;
        const conclusionText = data.topics.conclusion;

// Expresi√≥n regular para encontrar los puntos de la lista (ej: "1) habilitar pagos electr√≥nicos")
// El split crea un array. El primer elemento es el texto introductorio, los dem√°s son los puntos.
const points = conclusionText.split(/; \d\)/g); 

// El primer elemento suele ser la introducci√≥n o el primer punto incompleto.
let introduction = "";
let strategicPoints = [];

if (points.length > 0) {
    // Si el texto empieza con "Prioridades recomendadas: 1)", el split divide mal el primer elemento.
    // Buscamos el texto introductorio.
    const match = conclusionText.match(/(.*?):/); 
    if (match && match[1]) {
        introduction = match[1] + ":"; // Ejemplo: "Prioridades recomendadas:"
        
        // Creamos un array de puntos limpios
        strategicPoints = conclusionText
            .substring(introduction.length) // Quita la introducci√≥n
            .match(/\d\)\s(.*?)(?=; \d\)|$)/g); // Captura los puntos numerados (1), 2), etc.)
        
        // Limpiamos los puntos, quitando la numeraci√≥n inicial
        if (strategicPoints) {
            strategicPoints = strategicPoints.map(point => point.replace(/^\d\)\s/, '').trim());
        } else {
             // Caso de fallback si el regex es muy restrictivo
             strategicPoints = [conclusionText]; 
        }

    } else {
        // Fallback si no hay introducci√≥n clara
        strategicPoints = conclusionText.match(/\d\)\s(.*?)(?=; \d\)|$)/g) || [conclusionText];
         if (strategicPoints) {
            strategicPoints = strategicPoints.map(point => point.replace(/^\d\)\s/, '').trim());
        }
    }
}

let listHTML = `<p>${introduction || 'Conclusi√≥n Estrat√©gica:'}</p><ol>`;

// A√±adimos cada punto de la lista (ej: "habilitar pagos electr√≥nicos en todos los locales")
if (strategicPoints && strategicPoints.length > 0) {
    strategicPoints.forEach(point => {
        // Aseguramos que el punto no est√© vac√≠o y que no sea la frase final.
        if (point && !point.toLowerCase().includes('esto reducir√° el ruido negativo')) {
             listHTML += `<li>${point.trim()}</li>`;
        }
    });
}
listHTML += `</ol>`;

// A√±adimos el impacto final (√∫ltima frase) fuera de la lista numerada
listHTML += `<p><strong>Impacto Esperado:</strong> ${conclusionText.match(/Esto reducir√° el ruido negativo,.*?\./i) ? conclusionText.match(/Esto reducir√° el ruido negativo,.*?\./i)[0] : ''}</p>`;


// Inyectar el HTML de la lista
document.getElementById('conclusion-text').innerHTML = listHTML;

// --- FIN: C√ìDIGO MODIFICADO PARA LA CONCLUSI√ìN EN LISTA ---

        // 2. Renderizar M√©tricas de Sentimiento y Pie Chart
        const posVal = data.topics.feelings.positive.value;
        const negVal = data.topics.feelings.negative.value;
        const neuVal = data.topics.feelings.neutral.value;
        const total = posVal + negVal + neuVal;

        document.getElementById('pos-val').innerText = `${posVal}%`;
        document.getElementById('neg-val').innerText = `${negVal}%`;
        document.getElementById('neu-val').innerText = `${neuVal}%`;
        
        const pieChart = document.getElementById('sentiment-pie');
        
        const negDegree = (negVal / total) * 360;
        const posDegree = (posVal / total) * 360;
        const neuDegree = (neuVal / total) * 360;
        
        // Generar CSS para el Pie Chart usando conic-gradient (simulaci√≥n de pie chart sin librer√≠a)
        pieChart.style.background = `conic-gradient(
            var(--negative-color) 0deg ${negDegree}deg,
            var(--positive-color) ${negDegree}deg ${negDegree + posDegree}deg,
            var(--neutral-color) ${negDegree + posDegree}deg 360deg
        )`;

        // 3. Renderizar Acorde√≥n de T√≥picos
        const accordion = document.getElementById('topics-accordion');
        data.topics.topics.forEach((topic, index) => {
            const item = document.createElement('div');
            item.className = 'accordion-item';
            
            const title = document.createElement('div');
            title.className = 'accordion-title';
            title.innerHTML = `<span>${topic.title}</span><span style="font-size: 1.2em;">+</span>`;
            title.onclick = () => {
                const content = item.querySelector('.accordion-content');
                const isVisible = content.style.display === 'block';
                // Cerrar otros
                document.querySelectorAll('.accordion-content').forEach(c => c.style.display = 'none');
                document.querySelectorAll('.accordion-title span:last-child').forEach(s => s.textContent = '+');

                // Abrir/Cerrar actual
                content.style.display = isVisible ? 'none' : 'block';
                title.querySelector('span:last-child').textContent = isVisible ? '+' : '‚Äì';
            };

            const content = document.createElement('div');
            content.className = 'accordion-content';
            content.innerHTML = `
                <p><strong>Detalle:</strong> ${topic.detail}</p>
                <div class="sentiment-block positive">
                    <strong>‚úÖ Puntos Positivos:</strong> ${topic.positive}
                </div>
                <div class="sentiment-block negative">
                    <strong>‚ùå Puntos Negativos:</strong> ${topic.negative}
                </div>
                <div class="sentiment-block challenge">
                    <strong>üí° Desaf√≠os/Estrategias:</strong> ${topic.challenge}
                </div>
            `;
            
            item.appendChild(title);
            item.appendChild(content);
            accordion.appendChild(item);
        });

        // 4. Renderizar Top 10 Engagement
        const engagementTable = document.getElementById('top-engagement-table');
        const tweets = Object.keys(data.engagement_matrix.text).map(key => ({
            text: data.engagement_matrix.text[key],
            likes: data.engagement_matrix.favorite_count[key],
            retweets: data.engagement_matrix.retweet_count[key],
            engagement: data.engagement_matrix.total_engagement[key]
        })).sort((a, b) => b.engagement - a.engagement).slice(0, 10);
        
        tweets.forEach(tweet => {
            const row = engagementTable.insertRow();
            row.insertCell().innerText = tweet.text.length > 70 ? tweet.text.substring(0, 67) + '...' : tweet.text;
            row.insertCell().innerText = Math.round(tweet.likes).toLocaleString('es');
            row.insertCell().innerText = Math.round(tweet.retweets).toLocaleString('es');
        });

        // 5. Renderizar Estad√≠sticas Clave
        const statsTable = document.getElementById('stats-table');
        const metrics = ['favorite_count', 'retweet_count', 'user.followers_count'];
        const labels = ['Likes (Fav.)', 'Retweets (RTs)', 'Seguidores (User)'];
        
        metrics.forEach((metric, index) => {
            const row = statsTable.insertRow();
            row.insertCell().innerText = labels[index];
            row.insertCell().innerText = Math.round(data.describe_matrix.mean[metric]).toLocaleString('es');
            row.insertCell().innerText = Math.round(data.describe_matrix.max[metric]).toLocaleString('es');
        });

        // 6. Renderizar Colocaciones
        const colocationsList = document.getElementById('colocations-list');
        data.colocations.colocations.forEach(col => {
            const li = document.createElement('li');
            li.innerText = col.colocation;
            li.title = col.detail;
            colocationsList.appendChild(li);
        });

        // 7. Renderizar Heatmap (Likes por Hora y D√≠a)
        const heatmapTable = document.getElementById('heatmap-table');
        const days = Object.keys(data.heatmap);
        const hours = Object.keys(data.heatmap[days[0]]).map(h => parseFloat(h)).sort((a, b) => a - b);

        // Encontrar el valor m√°ximo para la escala de color (excluyendo -1.0)
        let maxLike = 0;
        days.forEach(day => {
            hours.forEach(hour => {
                const value = data.heatmap[day][hour.toFixed(1)];
                if (value > maxLike) {
                    maxLike = value;
                }
            });
        });

        // Funci√≥n para obtener color (simulaci√≥n de escala)
        const getColor = (value) => {
            if (value <= 0) return minColor; // Sin likes o dato no disponible
            const normalized = value / maxLike; // 0 a 1
            
            // Interpolaci√≥n de color (ejemplo simple entre blanco y el color primario)
            const r1 = 248, g1 = 244, b1 = 227; // var(--background-color) en RGB
            const r2 = 160, g2 = 82, b2 = 45; // var(--primary-color) en RGB

            const r = Math.round(r1 + (r2 - r1) * normalized);
            const g = Math.round(g1 + (g2 - g1) * normalized);
            const b = Math.round(b1 + (b2 - b1) * normalized);

            return `rgb(${r}, ${g}, ${b})`;
        };
        
        // Encabezado del Heatmap (D√≠as de la semana)
        let headerRow = heatmapTable.insertRow();
        headerRow.insertCell().outerHTML = '<th>Hora del D√≠a / D√≠a de la Semana</th>';
        days.forEach(day => {
            headerRow.insertCell().outerHTML = `<th>${day.slice(0,3)}</th>`;
        });

        // Filas del Heatmap (Horas del d√≠a)
        hours.forEach(hour => {
            let row = heatmapTable.insertRow();
            row.insertCell().outerHTML = `<th>${hour.toString().padStart(2, '0')}:00</th>`;
            
            days.forEach(day => {
                const value = data.heatmap[day][hour.toFixed(1)];
                const cell = row.insertCell();
                cell.style.backgroundColor = getColor(value);
                cell.style.color = value > (maxLike * 0.5) ? 'white' : 'var(--text-color)'; // Color de texto para contraste
                cell.innerText = value > 0 ? value.toFixed(1) : '-';
                cell.title = `Likes a las ${hour}:00 el ${day}`;
            });
        });

        // 8. Renderizar Entidades Interactivas
function renderInteractiveEntities(entities) {
    const container = document.getElementById('entity-list-container');
    const detailBox = document.getElementById('entity-detail-box');
    container.innerHTML = ''; // Limpiar contenedor

    // Usar la lista de entidades (entities) para mayor riqueza de datos
    entities.forEach(item => {
        // Crear el elemento de etiqueta
        const tag = document.createElement('span');
        tag.classList.add('interactive-tag');
        
        // Usar la Entidad como texto visible
        tag.textContent = item.entity;
        
        // Almacenar el detalle en un atributo de datos
        tag.dataset.detail = item.detail;

        // A√±adir el Listener de Click
        tag.addEventListener('click', function() {
            // 1. Quitar la clase 'active' de todas las etiquetas
            document.querySelectorAll('.interactive-tag').forEach(t => t.classList.remove('active'));
            
            // 2. A√±adir la clase 'active' a la etiqueta clickeada
            this.classList.add('active');
            
            // 3. Mostrar el detalle en la caja de detalle
            detailBox.innerHTML = `
                <p><strong>${item.entity}:</strong> ${this.dataset.detail}</p>
            `;
        });

        container.appendChild(tag);
    });
}

// Llama a la nueva funci√≥n de renderizado en tu funci√≥n 'initDashboard' o al inicio del script
// Aseg√∫rate de usar 'data.entities.entities' que contiene la lista completa de entidades
// Si quieres usar las Colocaciones, cambia el argumento a 'data.colocations.colocations'

// EJEMPLO: Si llamas a todas las funciones de renderizado dentro de initDashboard:
renderInteractiveEntities(data.entities.entities);
        //renderInteractiveEntities(data.colocations.colocations);
        
    </script>
</body>
</html>
